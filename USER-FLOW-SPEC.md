# 用户流程逻辑规范

## 🎯 核心原则

1. **登录状态全局一致** - 所有页面都能正确识别登录状态
2. **按钮逻辑清晰** - 已登录用户不应该看到"注册"、"登录"按钮
3. **跳转逻辑合理** - 根据用户状态智能跳转，不重复跳转

## 📋 页面访问规则

### 公开页面（无需登录）
- `/` - 首页
- `/auth/login` - 登录页
- `/auth/register` - 注册页

### 需要登录的页面
- `/chat` - 聊天页面
- `/image` - 图片生成
- `/orders` - 我的订单
- `/payment` - 支付页面

## 🔄 用户流程

### 场景 1: 未登录用户访问首页
**当前状态**: 未登录
**页面显示**:
- 导航栏: `登录` | `注册`
- Hero 按钮: `免费开始` → 跳转到 `/auth/register`
- 订阅按钮: `选择套餐` → 跳转到 `/auth/register`

### 场景 2: 已登录用户访问首页
**当前状态**: 已登录
**页面显示**:
- 导航栏: `用户邮箱` | `我的订单` | `登出`
- Hero 按钮: `开始使用` → 跳转到 `/chat`
- 订阅按钮: `选择套餐` → 跳转到 `/payment?plan=xxx`

### 场景 3: 未登录用户访问 /chat
**当前状态**: 未登录
**行为**: 自动跳转到 `/auth/login?redirect=/chat`
**登录后**: 自动跳转回 `/chat`

### 场景 4: 已登录用户访问 /auth/login
**当前状态**: 已登录
**行为**: 自动跳转到 `/chat`

### 场景 5: 已登录用户访问 /auth/register
**当前状态**: 已登录
**行为**: 自动跳转到 `/chat`

### 场景 6: 用户登录成功
**行为**:
- 如果有 redirect 参数 → 跳转到 redirect 指定的页面
- 如果没有 redirect → 跳转到 `/chat`

### 场景 7: 用户注册成功
**行为**:
- 自动登录
- 跳转到 `/chat`

### 场景 8: 用户登出
**行为**:
- 清除 session
- 跳转到 `/`（首页）

## 🎨 导航栏状态

### 未登录
```
[Logo] BoLuoing    模型 | 价格 | 功能    登录 | [注册按钮]
```

### 已登录
```
[Logo] BoLuoing    模型 | 价格 | 功能    user@email.com | 我的订单 | 登出
```

## 🔧 需要修复的问题

### 1. 首页 (app/page.tsx)
- [x] 添加登录状态检查
- [ ] 修复"免费开始"按钮逻辑（已登录应该跳转到 /chat）
- [ ] 修复订阅按钮逻辑（已登录应该跳转到 /payment）
- [ ] 导航栏显示用户邮箱而不是"进入聊天"

### 2. 登录页 (app/auth/login/page.tsx)
- [x] 使用真实的 Supabase 登录
- [ ] 添加 redirect 参数支持
- [ ] 已登录用户访问时自动跳转到 /chat

### 3. 注册页 (app/auth/register/page.tsx)
- [ ] 注册成功后自动登录
- [ ] 已登录用户访问时自动跳转到 /chat

### 4. 聊天页 (app/chat/page.tsx)
- [ ] 未登录用户自动跳转到 /auth/login?redirect=/chat
- [ ] 添加返回首页按钮

### 5. 订单页 (app/orders/page.tsx)
- [ ] 未登录用户自动跳转到 /auth/login?redirect=/orders

### 6. 支付页 (app/payment/page.tsx)
- [ ] 未登录用户自动跳转到 /auth/login?redirect=/payment

### 7. 图片页 (app/image/page.tsx)
- [ ] 未登录用户自动跳转到 /auth/login?redirect=/image

## ✅ 测试清单

### 未登录用户
- [ ] 访问首页 → 看到"登录"和"注册"按钮
- [ ] 点击"免费开始" → 跳转到注册页
- [ ] 点击"登录" → 跳转到登录页
- [ ] 直接访问 /chat → 跳转到登录页
- [ ] 登录后 → 自动跳转回 /chat

### 已登录用户
- [ ] 访问首页 → 看到用户邮箱和"登出"按钮
- [ ] 点击"开始使用" → 跳转到 /chat
- [ ] 点击"选择套餐" → 跳转到 /payment
- [ ] 访问 /auth/login → 自动跳转到 /chat
- [ ] 访问 /auth/register → 自动跳转到 /chat
- [ ] 点击"登出" → 跳转到首页，显示未登录状态

### 导航流程
- [ ] 首页 → 登录 → Chat → 返回首页（保持登录状态）
- [ ] 首页 → 注册 → Chat → 返回首页（保持登录状态）
- [ ] Chat → 登出 → 首页（显示未登录状态）
